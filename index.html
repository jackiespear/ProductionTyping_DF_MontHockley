
<!DOCTYPE html>
<html>
    <head>
        <title>Recognition Experiment</title>
        <meta name="author" content="Jackie Spear"/>
        <meta name="description" content="A psychology recognition memory experiment"/>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <script src="jspsych-6.3.1/jspsych.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-external-html.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-html-form.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-html-form-orig.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-button-response-orig.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-fullscreen.js"></script>
        <script src="stimuli/exp_text.js"></script>
        <script src="stimuli/pracstudy.js"></script>
        <script src="stimuli/pracstudy_black.js"></script>
        <script src="stimuli/practest.js"></script>
        <script src="stimuli/frontbufferlist_mixed.js"></script>
        <script src="stimuli/frontbufferlist_mixed_black.js"></script>
        <script src="stimuli/frontbufferlist_pureproduce.js"></script>
        <script src="stimuli/frontbufferlist_pureproduce_black.js"></script>
        <script src="stimuli/frontbufferlist_pureread.js"></script>
        <script src="stimuli/frontbufferlist_pureread_black.js"></script>
        <script src="stimuli/endbufferlist_mixed.js"></script>
        <script src="stimuli/endbufferlist_mixed_black.js"></script>
        <script src="stimuli/endbufferlist_pureproduce.js"></script>
        <script src="stimuli/endbufferlist_pureproduce_black.js"></script>
        <script src="stimuli/endbufferlist_pureread.js"></script>
        <script src="stimuli/endbufferlist_pureread_black.js"></script>
        <script src="stimuli/studylist1_mixed.js"></script>
        <script src="stimuli/studylist1_mixed_black.js"></script>
        <script src="stimuli/studylist1_pureproduce.js"></script>
        <script src="stimuli/studylist1_pureproduce_black.js"></script>
        <script src="stimuli/studylist1_pureread.js"></script>
        <script src="stimuli/studylist1_pureread_black.js"></script>
        <script src="stimuli/studylist2_mixed.js"></script>
        <script src="stimuli/studylist2_mixed_black.js"></script>
        <script src="stimuli/studylist2_pureproduce.js"></script>
        <script src="stimuli/studylist2_pureproduce_black.js"></script>
        <script src="stimuli/studylist2_pureread.js"></script>
        <script src="stimuli/studylist2_pureread_black.js"></script>
        <script src="stimuli/studylist3_mixed.js"></script>
        <script src="stimuli/studylist3_mixed_black.js"></script>
        <script src="stimuli/studylist3_pureproduce.js"></script>
        <script src="stimuli/studylist3_pureproduce_black.js"></script>
        <script src="stimuli/studylist3_pureread.js"></script>
        <script src="stimuli/studylist3_pureread_black.js"></script>
        <script src="stimuli/studylist4_mixed.js"></script>
        <script src="stimuli/studylist4_mixed_black.js"></script>
        <script src="stimuli/studylist4_pureproduce.js"></script>
        <script src="stimuli/studylist4_pureproduce_black.js"></script>
        <script src="stimuli/studylist4_pureread.js"></script>
        <script src="stimuli/studylist4_pureread_black.js"></script>
        <script src="stimuli/testlist1.js"></script>
        <script src="stimuli/testlist2.js"></script>
        <script src="stimuli/testlist3.js"></script>
        <script src="stimuli/testlist4.js"></script>
        <link href="jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
 
<script>

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                       Randomly Assign one of the between-subjects counterbalanced lists, experiments and cue conditions                      //
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

var experiment_assignment = jsPsych.randomization.sampleWithoutReplacement(['production_effect', 'directed_forgetting'], 1)[0];
jsPsych.data.addProperties({
  experiment: experiment_assignment
});

var during_after_assignment = jsPsych.randomization.sampleWithoutReplacement(['during', 'after'], 1)[0];
jsPsych.data.addProperties({
  cue_presentation: during_after_assignment
});

var condition_assignment = jsPsych.randomization.sampleWithoutReplacement(['pureproduce', 'pureread', 'mixed'], 1)[0];
jsPsych.data.addProperties({
  condition: condition_assignment
});

var list_assignment = jsPsych.randomization.sampleWithoutReplacement(['List1', 'List2', 'List3', 'List4'], 1)[0];
jsPsych.data.addProperties({
  list: list_assignment
});

console.log(experiment_assignment);
console.log(during_after_assignment);
console.log(condition_assignment);
console.log(list_assignment);

//console.log(list_assignment);

//original randomization procedure
var stimuli = [];
var stimuli_black = [];
var stimuli_test= [];
var instruction_text = []; //this and the following variables are depending on whether the exp is PE of DF
var post_practice_text = [];
var post_practice_text2 = [];
var test_instruction_text = [];
var study_procedure = []; //cue to produce/read, remember/forget is either during stimuli presentation or after


if (condition_assignment == "mixed" && list_assignment == "List1" && experiment_assignment =="production_effect" && during_after_assignment == "during") { //if List1 is sampled from above randomization routine, the stimuli presented will be...
  stimuli = studylist1_mixed;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "pureproduce" && list_assignment =="List1" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist1_pureproduce;
  stimuli_black = studylist1_pureproduce;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment == "List1" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist1_pureread;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "mixed" && list_assignment =="List2" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist2_mixed;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List2" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist2_pureproduce;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment =="List2" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist2_pureread;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "mixed" && list_assignment =="List3" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist3_mixed;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List3" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist3_pureproduce;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment =="List3" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist3_pureread;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "mixed" && list_assignment =="List4" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist4_mixed;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List4" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist4_pureproduce;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment =="List4" && experiment_assignment =="production_effect" && during_after_assignment == "during") {
  stimuli = studylist4_pureread;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_during;

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ///////////////////////////////////                             Directed Forgetting Randomization                      /////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
} else if(condition_assignment == "mixed" && list_assignment == "List1" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") { 
  stimuli = studylist1_mixed;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List1" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist1_pureproduce;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment == "List1" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist1_pureread;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "mixed" && list_assignment =="List2" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist2_mixed;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List2" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist2_pureproduce;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment =="List2" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist2_pureread;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "mixed" && list_assignment =="List3" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist3_mixed;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List3" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist3_pureproduce;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment =="List3" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist3_pureread;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;

} else if (condition_assignment == "mixed" && list_assignment =="List4" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist4_mixed;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureproduce" && list_assignment =="List4" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist4_pureproduce;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
} else if (condition_assignment == "pureread" && list_assignment =="List4" && experiment_assignment =="directed_forgetting" && during_after_assignment == "during") {
  stimuli = studylist4_pureread;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_during;
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ///////////////////////////                                 Cue presentation AFTER randomization               //////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

} else if (condition_assignment == "mixed" && list_assignment == "List1" && experiment_assignment =="production_effect" && during_after_assignment == "after") { //if List1 is sampled from above randomization routine, the stimuli presented will be...
  stimuli = studylist1_mixed;
  //stimuli_black = studylist1_mixed_black;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "pureproduce" && list_assignment =="List1" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist1_pureproduce;
  //stimuli_black = studylist1_pureproduce_black;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment == "List1" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist1_pureread;
  //stimuli_black = studylist1_pureread_black;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "mixed" && list_assignment =="List2" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist2_mixed;
 // stimuli_black = studylist2_mixed_black;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List2" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist2_pureproduce;
 // stimuli_black = studylist2_pureproduce_black;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment =="List2" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist2_pureread;
 // stimuli_black = studylist2_pureread_black;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "mixed" && list_assignment =="List3" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist3_mixed;
  //stimuli_black = studylist3_mixed_black;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List3" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist3_pureproduce;
  //stimuli_black = studylist3_pureproduce_black;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment =="List3" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist3_pureread;
 // stimuli_black = studylist3_pureread_black;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "mixed" && list_assignment =="List4" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist4_mixed;
  //stimuli_black = studylist4_mixed_black;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List4" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist4_pureproduce;
 // stimuli_black = studylist4_pureproduce_black;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment =="List4" && experiment_assignment =="production_effect" && during_after_assignment == "after") {
  stimuli = studylist4_pureread;
  //stimuli_black = studylist4_pureread_black;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_PE; 
  post_practice_text = post_practice_text_PE;
  post_practice_text2 = post_practice_text2_PE;
  test_instruction_text = test_instruction_text_PE;
  study_procedure = study_procedure_after;

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ///////////////////////////////////////                     Directed Forgetting Randomization               ////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
} else if(condition_assignment == "mixed" && list_assignment == "List1" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") { 
  stimuli = studylist1_mixed;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List1" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist1_pureproduce;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment == "List1" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist1_pureread;
  stimuli_test = testlist1;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "mixed" && list_assignment =="List2" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist2_mixed;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List2" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist2_pureproduce;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment =="List2" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist2_pureread;
  stimuli_test = testlist2;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "mixed" && list_assignment =="List3" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist3_mixed;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List3" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist3_pureproduce;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment =="List3" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist3_pureread;
  stimuli_test = testlist3;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;

} else if (condition_assignment == "mixed" && list_assignment =="List4" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist4_mixed;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_mixed;
  end_buffer_list = endbufferlist_mixed;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureproduce" && list_assignment =="List4" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist4_pureproduce;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureproduce;
  end_buffer_list = endbufferlist_pureproduce;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
} else if (condition_assignment == "pureread" && list_assignment =="List4" && experiment_assignment =="directed_forgetting" && during_after_assignment == "after") {
  stimuli = studylist4_pureread;
  stimuli_test = testlist4;
  front_buffer_list = frontbufferlist_pureread;
  end_buffer_list = endbufferlist_pureread;
  instruction_text = instruction_text_DF; 
  post_practice_text = post_practice_text_DF;
  post_practice_text2 = post_practice_text2_DF;
  test_instruction_text = test_instruction_text_DF;
  study_procedure = study_procedure_after;
};


//console.table(stimuli);
//console.log(stimuli);
//console.table(stimuli_test);

</script>

<!-- Allow remote storage on Google Firebase -->
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.12.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.12.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.12.0/firebase-database.js"></script>

<!-- enter some javascript code-->
<script type="text/javascript">

// See: https://crumplab.github.io/jspsychrexamples/FirebaseDemo/Instructions_FirebaseDemo.html 
// Your web app's Firebase configuration (given to us by firebase)

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////      Change this block of code for every new Firebase database         //////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Import the functions you need from the SDKs you need
//import { initializeApp } from "firebase/app";
//import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
//https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCKWuxriAZ4UcEKyAUZPXQ4BkyP3d2cjpk",
  authDomain: "productiondfmonthockley.firebaseapp.com",
  databaseURL: "https://productiondfmonthockley-default-rtdb.firebaseio.com/",        //// this needs to be updated
  projectId: "productiondfmonthockley",
  storageBucket: "productiondfmonthockley.appspot.com",
  messagingSenderId: "986660349366",
  appId: "1:986660349366:web:062cab13130c01fab70d17",
  measurementId: "G-J3P4ELE4XB",
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  // Get a reference to the database service
  var database = firebase.database();

   // login anonymous user
   firebase.auth().signInAnonymously().catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  // ...
});

  ////////////////////////////////////////////////////////////////
  

  // Get a reference to the database service
  var database = firebase.database();

   // login anonymous user
   firebase.auth().signInAnonymously().catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  // ...
});
  
  // check if user can sign on to firebase 
  firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in.
    var isAnonymous = user.isAnonymous;
    var uid = user.uid;
    // ...
  } else {
    // User is signed out.
    // ...
  }
  // ...
});
 
////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////                      Start jsPsych Experiment here                     //////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////


/* experiment parameters */
// generate a random subject ID with 15 characters
var subject_id = jsPsych.randomization.randomID(15);

// get the id number for the SONA participant so that we can grant credits automatically
var SONA_ID = getUrlParam('id','Empty');

function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}

// Get the time that the experiment began (ms since 1 January 1970)
var start_time = new Date().getTime();

// record this data to all trials
jsPsych.data.addProperties({
  subject: subject_id,
  StartTime: start_time,
});
    
// to check for consent
var consent_check = false;
    
 // function to check if in fullscreen mode
  function is_fullscreen(){
  // check if in fullscreen mode
  if(window.innerWidth == screen.width && window.innerHeight == screen.height){
    return true;
  }else{return false}
  }

  function getUrlParam(parameter, defaultvalue){
    var urlparameter = defaultvalue;
    if(window.location.href.indexOf(parameter) > -1){
        urlparameter = getUrlVars()[parameter];
        }
    return urlparameter;
  }

// set up consent procedure
var consent = {
  type: "external-html",
  url: "forms/consent.html",
  cont_btn: "consent-btns",
  data: {"phase": "Consent"},
};

// set up welcome screen 
var welcome = {
  type: "html-keyboard-response",
  stimulus: welcome_text,
  data: {"phase": "Welcome",
  },
};

// set up instructions screen (including attention check)
var instructions = {
  timeline: [
    // first trial is displaying the experiment instructions
    {
      type: "html-keyboard-response",
      stimulus: instruction_text,
      data: {"phase": "Instructions"},
    },
    // second trial is displaying the instructions check
    {
      type: "survey-text",
      questions: [
        {
          prompt: attention_check_text, 
          columns: 20, 
          rows: 1, 
          required: true, 
          name: "Attention_check"
        },
      ],
      data: {"phase": "Attention_Check"},
    },
  ],
  // wait 1 second after completion
  post_trial_gap: 1000,
  // record if in fullscreen
  on_finish: function(data){
    data.fullscreen = is_fullscreen();
  },
 // if the participant recorded anything except "4" then repeat (answer to 2+2 in the instructions)
 loop_function: function(data){
    console.log(data.values()[1]);
    response_data = data.values()[1].response;
    if(response_data.Attention_check == "4"){
      return false
    }else{
      return true
    }
  },
};

//Present the instruction to produce or read during PRACTICE phase - 'during' practice study phase
var study_practice = {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: function(){
        var html = `
          <p>${jsPsych.timelineVariable('stimulus')}</p>  
          `
        return html;
    },
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, // changing this to 3 seconds so that each trail is equal (e.g. produce vs. read),
    trial_duration: 3000,
    data: {phase:"practice", type: jsPsych.timelineVariable('data')},
    autofocus: 'test-resp-box',
};

// feedback on typing
var typing_feedback = {
  type: 'html-keyboard-response',
  stimulus: function(){
    // The feedback stimulus is a dynamic parameter because we can't know in advance whether
    // the stimulus should be 'correct' or 'incorrect'.
    // Instead, this function will check the accuracy of the last response and use that information to set
    // the stimulus value on each trial.
    var last_trial_typed1 = jsPsych.data.get().last(1).values()[0].response.response;
    var last_trial_typed = last_trial_typed1.toLowerCase();
    var last_trial_presented1 = jsPsych.data.get().last(1).values()[0].type.word;
    var last_trial_presented = last_trial_presented1.toLowerCase();
    var last_trial_condition = jsPsych.data.get().last(1).values()[0].type.condition;
    var last_trial_experiment = jsPsych.data.get().last(1).values()[0].experiment;

    if(last_trial_typed == last_trial_presented && last_trial_condition == "produce" && last_trial_experiment == "production_effect") {
      return "<p><span style='color:green;font-size:30px;'>Correct! You typed correctly!</span></p>"; // the parameter value has to be returned from the function
    } else if  (last_trial_experiment == "production_effect" && last_trial_condition == "read" && last_trial_typed == "") {
      return "<p><span style='color:green;font-size:30px;'>Correct! Thank you for reading! </span></p>";
    } else if (last_trial_experiment == "production_effect" && last_trial_condition == "read" && last_trial_typed != "") {
      return "<p><span style='color:red;font-size:30px;'>Incorrect. Please do not type.</span></p>";
    } else if (last_trial_experiment == "production_effect" && last_trial_condition == "produce" && last_trial_typed != last_trial_presented) {
      return "<p><span style='color:red;font-size:30px;'>Incorrect. You must type the exact word.</span></p>"; // the parameter value has to be returned from the function
    } else if (last_trial_experiment == "directed_forgetting") {
      return "<p><span style='color:white;font-size:1px;'>.</span></p>";
    }
  },
  choices:jsPsych.NO_KEYS,
  trial_duration:1000,
};

var practice_study_procedure = {
  timeline: [study_practice, typing_feedback],
  randomize_order: true,
  timeline_variables: pracstudy,
};


// 'after' practice study phase 
var after_study_practice = {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: jsPsych.timelineVariable("stimulus_black"),
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 0, 
    trial_duration: 1000, //change back to 1000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data_black")},
    autofocus: 'test-resp-box',
  };

  var after_study_practice2 = {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: jsPsych.timelineVariable("stimulus"),
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, 
    trial_duration: 3000, //change back to 3000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data")},
    autofocus: 'test-resp-box',
  };
  
// feedback on typing
var after_typing_feedback = {
  type: 'html-keyboard-response',
  stimulus: function(){
    // The feedback stimulus is a dynamic parameter because we can't know in advance whether
    // the stimulus should be 'correct' or 'incorrect'.
    // Instead, this function will check the accuracy of the last response and use that information to set
    // the stimulus value on each trial.
    var last_trial_typed1 = jsPsych.data.get().last(2).values()[0].response.response;
    var last_trial_typed = last_trial_typed1.toLowerCase();
    var last_trial_presented1 = jsPsych.data.get().last(2).values()[0].type.word;
    var last_trial_presented = last_trial_presented1.toLowerCase();
    var last_trial_condition = jsPsych.data.get().last(2).values()[0].type.condition;
    var last_trial_experiment = jsPsych.data.get().last(2).values()[0].experiment;

    if(last_trial_typed == last_trial_presented && last_trial_condition == "produce" && last_trial_experiment == "production_effect") {
      return "<p><span style='color:green;font-size:30px;'>Correct! You typed correctly!</span></p>"; // the parameter value has to be returned from the function
    } else if  (last_trial_experiment == "production_effect" && last_trial_condition == "read" && last_trial_typed == "") {
      return "<p><span style='color:green;font-size:30px;'>Correct! Thank you for reading! </span></p>";
    } else if (last_trial_experiment == "production_effect" && last_trial_condition == "read" && last_trial_typed != "") {
      return "<p><span style='color:red;font-size:30px;'>Incorrect. Please do not type.</span></p>";
    } else if (last_trial_experiment == "production_effect" && last_trial_condition == "produce" && last_trial_typed != last_trial_presented) {
      return "<p><span style='color:red;font-size:30px;'>Incorrect. You must type the exact word.</span></p>"; // the parameter value has to be returned from the function
    } else if (last_trial_experiment == "directed_forgetting") {
      return "<p><span style='color:white;font-size:1px;'>.</span></p>";
    }
  },
  choices:jsPsych.NO_KEYS,
  trial_duration:1000,
};

var practice_study_procedure_after = {
  timeline: [after_study_practice, after_study_practice2, after_typing_feedback],
  randomize_order: true,
  timeline_variables: pracstudy,
};












var prac_test_phase = {

            type: 'html-keyboard-response',
            stimulus: jsPsych.timelineVariable('stimulus'),
            choices: ['y', 'n'],
            data: {data: jsPsych.timelineVariable("data"), phase: "prac_test"},
            response_ends_trial:true,
            timeline_variables: stimuli_test,
            post_trial_gap: 500, // like a blank 500
             on_finish: function(data) {
              if (data.response == "y" && data.data.type == "old") {
                data.correct = 1;
              } else if (data.response == "n" && data.data.type == "new") {
                data.correct = 1;
              }
              else {
                data.correct = 0;
              }
            } 
};

var feedback = {
  type: 'html-keyboard-response',
  stimulus: function(){
    // The feedback stimulus is a dynamic parameter because we can't know in advance whether
    // the stimulus should be 'correct' or 'incorrect'.
    // Instead, this function will check the accuracy of the last response and use that information to set
    // the stimulus value on each trial.
    var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
    if(last_trial_correct){
      return "<p><span style='color:green;font-size:30px;'>Correct!</span></p>"; // the parameter value has to be returned from the function
    } else {
      return "<p><span style='color:red;font-size:30px;'>Incorrect.</span></p>"; // the parameter value has to be returned from the function
    }
  },
  choices:jsPsych.NO_KEYS,
  trial_duration:1000,
};

var practice_test_procedure = {
  timeline: [prac_test_phase, feedback],
  randomize_order: true,
  timeline_variables: practest,
};



// pre PRACTICE phase instructions
var practice_test_instructions_pre = {
  type: "html-keyboard-response",
  stimulus: pre_practice_text,
  choices: ['w'],
  data: {"phase": "Practice_Test_Instructions",
},
};

//test phase instructions presented before test PRACTICE phase 
var practice_test_instructions = {
  type: "html-keyboard-response",
  stimulus: post_practice_text,
  choices: ['w'],
  data: {"phase": "Practice_Test_Instructions",
},
};

//test phase instructions presented after entire PRACTICE phase is over
var practice_test_instructions_post = {
  type: "html-keyboard-response",
  stimulus: post_practice_text2,
  choices: ['w'],
  data: {"phase": "Practice_Test_Instructions",
},
};


//Study Phase - Front Buffer Items
var study_front_buffer = {
  timeline:[
    {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: function(){
        var html = `
          <p style='font-size: 48px;'>${jsPsych.timelineVariable('stimulus')}</p>
          `
        return html;
    },
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style="color:white;"/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, 
    trial_duration: 3000, //change back to 3000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data")},
    autofocus: 'test-resp-box',

  }
],
    timeline_variables: front_buffer_list,
    randomize_order:true,
};

//Study Phase
var study_instructions123 = {
  timeline: [
    {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: function(){
        var html = `
          <p style='font-size: 48px;'>${jsPsych.timelineVariable('stimulus')}</p>
          `
        return html;
    },
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style="color:white;"/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, 
    trial_duration: 3000, //change back to 3000
    data: {phase:"study", data: jsPsych.timelineVariable("data")},
    autofocus: 'test-resp-box',
  }
],
//timeline_variables: stimuli,
randomize_order:true,
};

//Study Phase - End Buffer Items
var study_end_buffer = {
  timeline:[
    {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: function(){
        var html = `
          <p style='font-size: 48px;'>${jsPsych.timelineVariable('stimulus')}</p>
          `
        return html;
    },
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, 
    trial_duration: 3000, //change back to 3000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data")},
    autofocus: 'test-resp-box',

  }
],
    timeline_variables: end_buffer_list,
    randomize_order:true,
};

//Putting the study words and study instruction together
 var study_procedure_during = {
   timeline: [study_instructions123],        // modifiy this to add the buffer items at the beginning and at the end
   timeline_variables: stimuli,
   randomize_order: true,
 };



 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 /////                                Study Phase where cue to Produce/Remember or Read/Forget is presented AFTER item presentation                  //
 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Study Phase - Front Buffer Items - for after procedure 
var after_study_front_buffer = {
  timeline:[
    {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: jsPsych.timelineVariable("stimulus_black"),
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 0, 
    trial_duration: 1000, //change back to 1000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data_black")},
    autofocus: 'test-resp-box',
  },

  {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: jsPsych.timelineVariable("stimulus"),
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, 
    trial_duration: 3000, //change back to 3000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data")},
    autofocus: 'test-resp-box',
  },
],
    timeline_variables: front_buffer_list,
    randomize_order:true,
};

/////////////////////////////////////////// after_study_procedure changed to --- study_procedure_after 

var study_procedure_after = {
  timeline: [
    {
      type: 'survey-html-form',
      button_label: 'Press enter to continue',
      preamble: jsPsych.timelineVariable("stimulus_black"),
      html: '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
      post_trial_gap: 0,
      trial_duration: 1000,
      data: {phase:"study", data: jsPsych.timelineVariable("data_black")},
      autofocus: 'test-resp-box',
    },

    {
      type: 'survey-html-form',
      button_label: 'Press enter to continue',
      preamble: jsPsych.timelineVariable("stimulus"),
      html: '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
      post_trial_gap: 500,
      trial_duration: 3000,
      data: {phase:"study", data: jsPsych.timelineVariable("data")},
      autofocus: 'test-resp-box',
    },
  ],
  timeline_variables: stimuli,
  randomize_order: true,
};
/////////////////////////////////////////////////

//Study Phase - End Buffer Items // for afer procedure  
var after_study_end_buffer = {
  timeline:[
    {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: jsPsych.timelineVariable("stimulus_black"),
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 0, 
    trial_duration: 1000, //change back to 3000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data_black")},
    autofocus: 'test-resp-box',
  },

  {
    type: 'survey-html-form',
    button_label: 'Press enter to continue',
    preamble: jsPsych.timelineVariable("stimulus"),
    html:  '<p> <input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box" name="response" size="10" style=color:white;/></p>', //color being white will not mirror typed word to the screen
    post_trial_gap: 500, 
    trial_duration: 3000, //change back to 3000
    data: {phase:"study_buffer", data: jsPsych.timelineVariable("data")},
    autofocus: 'test-resp-box',
  },
],
    timeline_variables: end_buffer_list,
    randomize_order:true,
};




/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //test phase instructions presented after study phase is over
var test_instructions = {
  type: "html-keyboard-response",
  stimulus: test_instruction_text,
  choices: ['i'],
  data: {"phase": "Test_Instructions",
  },
};


//Present the test words
var test_phase = {
    timeline: [
        {
            type: 'html-keyboard-response',
            stimulus: jsPsych.timelineVariable('stimulus'),
            choices: ['y', 'n'],
            data: {data: jsPsych.timelineVariable("data"), phase: "test"},
            response_ends_trial:true,
            timeline_variables: stimuli_test,
            post_trial_gap: 500, // like a blank 500
             on_finish: function(data) {
              if (data.response == "y" && data.data.type == "old") {
                data.correct = 1;
              } else if (data.response == "n" && data.data.type == "new") {
                data.correct = 1;
              }
              else {
                data.correct = 0;
              }
            } 
        }
    ],
    randomize_order: true,
    timeline_variables: stimuli_test,
};

var question_trial_sex = {
  type: 'html-button-response-orig',
  stimulus: '<p style="font-size:28px;">What is your sex assigned at birth?</p>',
  choices: ['Female', 'Male', 'Other', 'Prefer not to answer'],
  prompt: '<p>Please click one</p>',
  data: {type_dem: 'sex'},
  on_finish: function(data) {
              if (data.response == "0") {
                data.sex = "Female";
              } else if (data.response == "1") {
                data.sex = "Male";
              } else if (data.reponse == "2") {
                data.sex = "Other";
              }
              else {
                data.sex = "PreferNotAnswer";
              }
    }
};

var question_trial_gender = {
  type: 'survey-html-form-orig',
  button_label: 'Click here to continue',
  trial_duration: 3000,
  preamble: '<p>What is is your gender?<br>(Leave blank if you prefer not to answer)</p>',
  html: '<p><input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box2" name="gender" size="10" style=color:black;/></p>',
  autofocus: 'test-resp-box2',
  data: {type_dem: 'gender'},
};

var question_trial_age = {
  type: 'survey-html-form-orig',
  button_label: 'Click here to continue',
  trial_duration: 3000,
  preamble: '<p>What is is your age?<br>(Leave blank if you prefer not to answer)</p>',
  html: '<p><input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box2" name="age" size="10" style=color:black;/></p>',
  autofocus: 'test-resp-box2',
  data: {type_dem: 'age'},
};

var question_trial_english = {
  type: 'html-button-response-orig',
  stimulus: '<p style="font-size:28px;">Is English your first language?</p>',
  choices: ['Yes', 'No', 'Prefer not to answer'],
  prompt: '<p>Please click one</p>',
  data: {type_dem: 'english'},
  on_finish: function(data) {
              if (data.response == "0") {
                data.english = "Yes";
              } else if (data.response == "1") {
                data.english = "No";
              }
              else {
                data.english = "PreferNotAnswer";
              }
    }
};

var question_trial_distraction = {
  type: 'survey-html-form-orig',
  button_label: 'Click here to continue',
  trial_duration: 3000,
  preamble: '<p>Were you doing anything else during the experiment? (e.g. watching TV)<br>(If yes please indicate)</p>',
  html: '<p><input type="text" onkeydown="return (event.keycode!=13);" id="test-resp-box2" name="distract" size="10" style=color:black;/></p>',
  autofocus: 'test-resp-box2',
  data: {type_dem: 'distract'},
};


var survey = {
  data: {"phase": "Demographics"},
  timeline: [
    question_trial_sex,
    question_trial_gender,
    question_trial_age,
    question_trial_english,
    question_trial_distraction,
  ]
};

// set up debrief block
var debrief = {
  type: "html-keyboard-response",
  stimulus: debrief_text,
  //post_trial_gap: 1000
};

// set up full_screen mode
var enter_full_screen = {
  type: 'fullscreen',
  fullscreen_mode: true,
  message: fullscreen_prompt,
  // disable button for 15 seconds to force reading
  on_load: function(data){
    var test = document.querySelectorAll('button')[0];
    test.disabled = true;
    setTimeout(() => {test.disabled = false;},15000); // setting timeout to 15 seconds here
  }
};

// prepare an end to full_screen mode 
var exit_full_screen = {
  type: 'fullscreen',
  fullscreen_mode: false,
  // save data when going through exit full screen routine
  // will save data at this point if they have alrady exited full screen
  on_finish: function() {
    firebase.database().ref(subject_id).set({
      data: jsPsych.data.get().values()
    })
  }
};

// if a subject does not consent //
var no_consent = {
  timeline: [
    {
      type: "external-html",
      url: "forms/no_consent_deb.html",
      data: {"phase": "No_consent"},
    },
    ],
  conditional_function: function(data){
    if(consent_check == false){
      return true
    }else{
      return false
    }
  }
};

/*set up experiment structure*/
var timeline = [];
timeline.push(consent);
timeline.push(no_consent);
timeline.push(welcome);
timeline.push(enter_full_screen);
timeline.push(instructions);
timeline.push(practice_test_instructions_pre);

if(during_after_assignment == "during") {
  timeline.push(practice_study_procedure);
} else {
  timeline.push(practice_study_procedure_after);
};

timeline.push(practice_test_instructions);
timeline.push(practice_test_procedure);
timeline.push(practice_test_instructions_post);

if(during_after_assignment == "during") {
  timeline.push(study_front_buffer);
} else {
  timeline.push(after_study_front_buffer);
};

if(during_after_assignment == "during") {
  timeline.push(study_procedure_during);
} else {
  timeline.push(study_procedure_after);
};

if(during_after_assignment == "during") {
  timeline.push(study_end_buffer);
} else {
  timeline.push(after_study_end_buffer);
};

timeline.push(test_instructions);
timeline.push(test_phase);
timeline.push(survey);
timeline.push(exit_full_screen);
timeline.push(debrief);

/*start experiment*/
jsPsych.init({
    timeline: timeline,
    on_finish: function() {
     window.location.href = "https://umanitobapsych.sona-systems.com/webstudy_credit.aspx?experiment_id=1562&credit_token=26a8ab31eea847cdbd7079fef3572e01&survey_code="+SONA_ID; //changed
      // display data at end:
      //jsPsych.data.displayData(); //commented out for final version
    }
});


  </script>
  </html>
